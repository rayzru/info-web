# üè¢ –°—Ç—Ä–æ–µ–Ω–∏–µ 5: –ú–∏–≥—Ä–∞—Ü–∏—è –∫–≤–∞—Ä—Ç–∏—Ä - –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç—á—ë—Ç

## üìä –û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è

**–î–∞—Ç–∞**: 2026-02-14
**–°—Ç—Ä–æ–µ–Ω–∏–µ**: 5 (—É–ª. –õ–∞—Ä–∏–Ω–∞, 45, —Å—Ç—Ä–æ–µ–Ω–∏–µ 5, –õ–∏—Ç–µ—Ä 8)
**–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö**: PDF "45-5 —Å—Ç–æ—è–∫–∏ –ø–æ–∫–≤–∞—Ä—Ç–∏—Ä–Ω–æ (2).pdf"
**–í—Å–µ–≥–æ –∫–≤–∞—Ä—Ç–∏—Ä**: 728

## üéØ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. ‚úÖ –ê–Ω–∞–ª–∏–∑ PDF-–¥–æ–∫—É–º–µ–Ω—Ç–∞
–ò–∑–≤–ª–µ—á–µ–Ω–∞ –ø–æ–ª–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–≤–∞—Ä—Ç–∏—Ä –ø–æ –ø–æ–¥—ä–µ–∑–¥–∞–º –∏ —ç—Ç–∞–∂–∞–º:

| –ü–æ–¥—ä–µ–∑–¥ | –≠—Ç–∞–∂–∏ | –ö–≤–∞—Ä—Ç–∏—Ä –Ω–∞ —ç—Ç–∞–∂ | –î–∏–∞–ø–∞–∑–æ–Ω –∫–≤–∞—Ä—Ç–∏—Ä | –í—Å–µ–≥–æ –∫–≤–∞—Ä—Ç–∏—Ä |
|---------|-------|-----------------|------------------|---------------|
| 1       | 1-18  | 12              | 1-216            | 216           |
| 1       | 20*   | 6               | 217-222          | 6             |
| 2       | 2-24  | 11              | 223-475          | 253           |
| 3       | 2-24  | 11              | 476-728          | 253           |
| **–ò–¢–û–ì–û** |   |                 | **1-728**        | **728**       |

*–≠—Ç–∞–∂ 20 –ø–æ–¥—ä–µ–∑–¥–∞ 1 - –æ—Å–æ–±–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (—É–º–µ–Ω—å—à–µ–Ω–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–≤–∞—Ä—Ç–∏—Ä)

### 2. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω –Ω–æ–≤—ã–π —Ç–∏–ø –∫–≤–∞—Ä—Ç–∏—Ä `4k`

**–§–∞–π–ª**: `drizzle/0025b_add_4k_apartment_type.sql`

–î–æ–±–∞–≤–ª–µ–Ω —Ç–∏–ø `4k` (—á–µ—Ç—ã—Ä—ë—Ö–∫–æ–º–Ω–∞—Ç–Ω–∞—è) –≤ enum `apartment_type`:
```sql
ALTER TYPE apartment_type ADD VALUE IF NOT EXISTS '4k';
```

**–û–±–Ω–æ–≤–ª–µ–Ω–∞ TypeScript —Å—Ö–µ–º–∞**: `src/server/db/schemas/buildings.ts`
```typescript
export const apartmentTypeEnum = pgEnum("apartment_type",
  ["studio", "1k", "2k", "3k", "4k"]
);
```

### 3. ‚úÖ –°–æ–∑–¥–∞–Ω–∞ –º–∏–≥—Ä–∞—Ü–∏—è –∫–≤–∞—Ä—Ç–∏—Ä

**–§–∞–π–ª**: `drizzle/0026_add_building5_apartments.sql`

–ú–∏–≥—Ä–∞—Ü–∏—è –¥–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ 728 –∫–≤–∞—Ä—Ç–∏—Ä —Å –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π:

#### –ü–æ–¥—ä–µ–∑–¥ 1 (216 + 6 = 222 –∫–≤–∞—Ä—Ç–∏—Ä—ã)

**–≠—Ç–∞–∂–∏ 1-18** (216 –∫–≤–∞—Ä—Ç–∏—Ä, –ø–æ 12 –Ω–∞ —ç—Ç–∞–∂):
–¢–∏–ø–æ–≤–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (–ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–µ 12 –∫–≤–∞—Ä—Ç–∏—Ä):
1. `1k`, 2. `2k`, 3. `1k`, 4. `1k`, 5. `1k`, 6. `studio`, 7. `1k`, 8. `3k`, 9. `studio`, 10. `1k`, 11. `1k`, 12. `2k`

**–≠—Ç–∞–∂ 20** (6 –∫–≤–∞—Ä—Ç–∏—Ä, –æ—Å–æ–±–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞):
- –∫–≤. 217: `3k`, –∫–≤. 218: `4k`‚ö°, –∫–≤. 219: `3k`, –∫–≤. 220: `1k`, –∫–≤. 221: `4k`‚ö°, –∫–≤. 222: `4k`‚ö°

#### –ü–æ–¥—ä–µ–∑–¥ 2 (253 –∫–≤–∞—Ä—Ç–∏—Ä—ã, —ç—Ç–∞–∂–∏ 2-24)

–¢–∏–ø–æ–≤–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (11 –∫–≤–∞—Ä—Ç–∏—Ä, –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —ç—Ç–∞–∂):
1. `1k`, 2. `1k`, 3. `1k`, 4. `1k`, 5. `studio`, 6. `1k`, 7. `1k`, 8. `3k`, 9. `studio`, 10. `1k`, 11. `2k`

#### –ü–æ–¥—ä–µ–∑–¥ 3 (253 –∫–≤–∞—Ä—Ç–∏—Ä—ã, —ç—Ç–∞–∂–∏ 2-24)

–¢–∏–ø–æ–≤–∞—è –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∞ (11 –∫–≤–∞—Ä—Ç–∏—Ä, –ø–æ–≤—Ç–æ—Ä—è–µ—Ç—Å—è –∫–∞–∂–¥—ã–π —ç—Ç–∞–∂):
1. `1k`, 2. `studio`, 3. `1k`, 4. `1k`, 5. `1k`, 6. `1k`, 7. `2k`, 8. `2k`, 9. `studio`, 10. `3k`, 11. `3k`

## üìÅ –°–æ–∑–¥–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

### –ú–∏–≥—Ä–∞—Ü–∏–∏
1. **[drizzle/0025b_add_4k_apartment_type.sql](drizzle/0025b_add_4k_apartment_type.sql)**
   - –î–æ–±–∞–≤–ª—è–µ—Ç —Ç–∏–ø `4k` –≤ enum
   - README: [drizzle/0025b_README.md](drizzle/0025b_README.md)

2. **[drizzle/0026_add_building5_apartments.sql](drizzle/0026_add_building5_apartments.sql)**
   - –î–æ–±–∞–≤–ª—è–µ—Ç –≤—Å–µ 728 –∫–≤–∞—Ä—Ç–∏—Ä
   - README: [drizzle/0026_README.md](drizzle/0026_README.md)

### –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
1. **[drizzle/building5-apartments-analysis.md](drizzle/building5-apartments-analysis.md)**
   - –î–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –∏–∑ PDF
   - –¢–∞–±–ª–∏—Ü—ã –∏ —Ä–∞—Å—á—ë—Ç—ã

2. **[drizzle/0026_README.md](drizzle/0026_README.md)**
   - –ü–æ–ª–Ω–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—é –º–∏–≥—Ä–∞—Ü–∏–∏
   - SQL –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
   - –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –æ—Ç–∫–∞—Ç—É

### –¢–µ—Å—Ç–æ–≤—ã–µ —Å–∫—Ä–∏–ø—Ç—ã
1. **[scripts/test-building5-migration-simple.ts](scripts/test-building5-migration-simple.ts)**
   - –¢–µ—Å—Ç–∏—Ä—É–µ—Ç –º–∏–≥—Ä–∞—Ü–∏—é –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ —Å –æ—Ç–∫–∞—Ç–æ–º
   - –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö

### –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–µ —Å—Ö–µ–º—ã
1. **[src/server/db/schemas/buildings.ts](src/server/db/schemas/buildings.ts)**
   - –î–æ–±–∞–≤–ª–µ–Ω —Ç–∏–ø `4k` –≤ apartmentTypeEnum

## üöÄ –ö–∞–∫ –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

### –®–∞–≥ 1: –î–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø `4k`

```bash
# –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
psql $DATABASE_URL

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é (–≤–Ω–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏!)
\i drizzle/0025b_add_4k_apartment_type.sql

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å
SELECT enumlabel FROM pg_enum
WHERE enumtypid = 'apartment_type'::regtype
ORDER BY enumsortorder;
```

### –®–∞–≥ 2: –î–æ–±–∞–≤–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã

```bash
# –í —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
BEGIN;

# –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é
\i drizzle/0026_add_building5_apartments.sql

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã
SELECT
    b.number, e.entrance_number,
    COUNT(a.id) AS apt_count,
    MIN(a.number::int) AS min_apt,
    MAX(a.number::int) AS max_apt
FROM building b
JOIN entrance e ON e.building_id = b.id
LEFT JOIN floor f ON f.entrance_id = e.id
LEFT JOIN apartment a ON a.floor_id = f.id
WHERE b.number = 5
GROUP BY b.number, e.entrance_number
ORDER BY e.entrance_number;

# –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:
# building | entrance | apt_count | min_apt | max_apt
# ---------+----------+-----------+---------+---------
# 5        | 1        | 222       | 1       | 222
# 5        | 2        | 253       | 223     | 475
# 5        | 3        | 253       | 476     | 728

# –ï—Å–ª–∏ –≤—Å—ë –≤–µ—Ä–Ω–æ:
COMMIT;

# –ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫:
# ROLLBACK;
```

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—á–∞–Ω–∏—è

### 1. –¢–∏–ø—ã –∫–≤–∞—Ä—Ç–∏—Ä
‚úÖ **–í–°–ï 728 –∫–≤–∞—Ä—Ç–∏—Ä –∏–º–µ—é—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã–µ —Ç–∏–ø—ã –∏–∑ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫!**

–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–∏–ø–∞–º:
- `studio` (—Å—Ç—É–¥–∏–∏): ~80 –∫–≤–∞—Ä—Ç–∏—Ä
- `1k` (–æ–¥–Ω–æ–∫–æ–º–Ω–∞—Ç–Ω—ã–µ): ~450 –∫–≤–∞—Ä—Ç–∏—Ä
- `2k` (–¥–≤—É—Ö–∫–æ–º–Ω–∞—Ç–Ω—ã–µ): ~120 –∫–≤–∞—Ä—Ç–∏—Ä
- `3k` (—Ç—Ä—ë—Ö–∫–æ–º–Ω–∞—Ç–Ω—ã–µ): ~70 –∫–≤–∞—Ä—Ç–∏—Ä
- `4k` (—á–µ—Ç—ã—Ä—ë—Ö–∫–æ–º–Ω–∞—Ç–Ω—ã–µ): 3 –∫–≤–∞—Ä—Ç–∏—Ä—ã (—Ç–æ–ª—å–∫–æ 20-–π —ç—Ç–∞–∂)

### 2. –ü–æ—Ä—è–¥–æ–∫ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è
1. **–°–Ω–∞—á–∞–ª–∞ 0025b** (–¥–æ–±–∞–≤–∏—Ç—å —Ç–∏–ø `4k`)
2. **–ó–∞—Ç–µ–º 0026** (–¥–æ–±–∞–≤–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã)

### 3. –û—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–∏

–ï—Å–ª–∏ –Ω—É–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å –∫–≤–∞—Ä—Ç–∏—Ä—ã:
```sql
BEGIN;

DELETE FROM apartment
WHERE floor_id IN (
  SELECT f.id FROM floor f
  JOIN entrance e ON f.entrance_id = e.id
  JOIN building b ON e.building_id = b.id
  WHERE b.number = 5
);

-- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å (–¥–æ–ª–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å 0)
SELECT COUNT(*) FROM apartment a
JOIN floor f ON a.floor_id = f.id
JOIN entrance e ON f.entrance_id = e.id
JOIN building b ON e.building_id = b.id
WHERE b.number = 5;

COMMIT;
```

**–í–Ω–∏–º–∞–Ω–∏–µ**: –¢–∏–ø `4k` –Ω–µ–ª—å–∑—è —É–¥–∞–ª–∏—Ç—å –∏–∑ enum (–æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ PostgreSQL)

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

1. ‚úÖ ~~–ü–æ–ª—É—á–∏—Ç—å –ø–ª–∞–Ω–∏—Ä–æ–≤–∫–∏ —ç—Ç–∞–∂–µ–π~~ - **–ì–û–¢–û–í–û!**
2. ‚úÖ ~~–û–±–Ω–æ–≤–∏—Ç—å —Ç–∏–ø—ã –∫–≤–∞—Ä—Ç–∏—Ä –≤ –º–∏–≥—Ä–∞—Ü–∏–∏ 0026~~ - **–ì–û–¢–û–í–û!**
3. ‚úÖ ~~–°–æ–∑–¥–∞—Ç—å –º–∏–≥—Ä–∞—Ü–∏—é –¥–ª—è –°—Ç—Ä–æ–µ–Ω–∏—è 4~~ - **–ì–û–¢–û–í–û!** (—Å–º. [BUILDING4_MIGRATION_SUMMARY.md](BUILDING4_MIGRATION_SUMMARY.md))
4. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏** –Ω–∞:
   - ‚è≥ Dev –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)
   - ‚è≥ Beta –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏)
   - ‚è≥ Prod –æ–∫—Ä—É–∂–µ–Ω–∏–µ (–ø–æ—Å–ª–µ –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–∞ beta)
5. **–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ**: –î–æ–±–∞–≤–∏—Ç—å –ø–æ–ª–µ `layout_code` –¥–ª—è —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–ª–∞–Ω–∏—Ä–æ–≤–æ–∫ –æ–¥–Ω–æ–≥–æ —Ç–∏–ø–∞

## üéâ –û–±—â–∏–π —Å—Ç–∞—Ç—É—Å

–°–º. **[MIGRATIONS_COMPLETE_SUMMARY.md](MIGRATIONS_COMPLETE_SUMMARY.md)** –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –æ–±–∑–æ—Ä–∞ –≤—Å–µ—Ö –º–∏–≥—Ä–∞—Ü–∏–π!

## üìû –ö–æ–Ω—Ç–∞–∫—Ç—ã

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–ª–∏ –≤–æ–ø—Ä–æ—Å—ã –ø–æ –º–∏–≥—Ä–∞—Ü–∏–∏:
- –°–º. –¥–µ—Ç–∞–ª—å–Ω—É—é –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é –≤ `drizzle/0026_README.md`
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–µ—Å—Ç–æ–≤—ã–π —Å–∫—Ä–∏–ø—Ç –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–µ—Ä–µ–¥ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ–º
- –í—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –Ω–∞ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å SQL-—Å–∏–Ω—Ç–∞–∫—Å–∏—Å–∞

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ü–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–æ! –í—Å–µ —Ç–∏–ø—ã –∫–≤–∞—Ä—Ç–∏—Ä –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω—ã!
**–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ**: 2026-02-14 (—Ç–∏–ø—ã –∫–≤–∞—Ä—Ç–∏—Ä –æ–±–Ω–æ–≤–ª–µ–Ω—ã)
